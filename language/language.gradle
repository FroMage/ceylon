ext {
    ceylonModuleName = 'language'
}

apply plugin : LifecycleBasePlugin
apply plugin : CeylonCommonBuildProperties

configurations {
    antOutput
}

dependencies {
    antOutput fileTree("${buildDir}/dist") {
        include "**/*.jar"
        include "**/*.car"
    }
}

task invokeAntBuild( type : GradleBuild ) {
    dir = projectDir
    buildFile = file('ant-language.gradle')
    tasks = ['antPublish']
    startParameter.projectProperties+= [
        ceylonDistDir  : distDir,
        ceylonRepoDir  : repoDir,
        ceylonLibDir   : repoLibDir,
        ceylonBuildDir : buildDir
    ]

    // TODO: There are too many of these manual dependencies being listed... feels like duct-tape and string.
    dependsOn ':compiler-java:assemble', ':compiler-java:publishJvmCompilerJars', ':runtime:setupRepo'
}

assemble.dependsOn invokeAntBuild

task publishInternal {
    dependsOn invokeAntBuild
}

['common','cli','model','cmr','compiler-java','langtools-classfile','typechecker','compiler-js'].each {
    publishInternal.dependsOn ":${it}:publishInternal"
    invokeAntBuild.dependsOn ":${it}:publishInternal"
}
