<project name="MyProject" default="test" basedir=".">
  <property name="src" location="output"/>
  <property name="build" location="classes"/>
  <property name="tmp" location="tmp"/>
  <property name="antlr" location="../lib/antlrworks-1.3.1.jar"/>

  <target name="compile" >
    <mkdir dir="${build}"/>

    <java classname="org.antlr.Tool">
      <arg value="-o"/> <arg value="${src}"/>
      <arg value="ceylon.g"/>
      <classpath>
        <pathelement location="${antlr}"/>
      </classpath>
    </java>
    
    <javac
       srcdir="${src}" destdir="${build}"
       debug="true"
       classpath="${antlr}">
      <compilerarg file="CeylonCompiler.java"/>
      <compilerarg file="CeylonTree.java"/>
      <compilerarg file="CeylonTreeVisitor.java"/>
      <compilerarg file="CeylonTreePrinter.java"/>
    </javac>
  </target>

  <target name="test" depends="compile">
    <apply executable="java">
      <arg value="-cp"/> <arg value="${antlr}:${build}"/>
      <arg value="CeylonCompiler"/>      
      <arg value="-d"/>
      <arg value="${tmp}"/>
      <fileset dir="../corpus/tests">
	<include name="*.ceylon"/>
      </fileset>
    </apply>

    <apply executable="diff" failonerror="true">      
      <arg value="-w"/>
      <arg value="${tmp}"/>
      <fileset dir="../corpus/tests">
	<include name="*.ceylon.out"/>
      </fileset>
    </apply>
  </target>

  <target name="clean">
    <delete dir="${src}"/>
    <delete dir="${build}"/>
    <delete dir="${tmp}"/>
  </target>
</project>
